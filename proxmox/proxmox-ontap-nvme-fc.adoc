---
sidebar: sidebar
permalink: proxmox/proxmox-ontap-nvme-fc.html
keywords: netapp, proxmox, proxmox ve, nvme, nvme-fc, lvm, ontap, storage
summary: "Configure Logical Volume Manager (LVM) with NVMe over Fibre Channel for Proxmox Virtual Environment using ONTAP. This procedure includes nvme-cli installation, namespace provisioning, subsystem setup, and volume group creation for shared storage."
---
= Configure LVM with NVMe/FC for Proxmox VE
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ../media/

[.lead]
Configure Logical Volume Manager (LVM) for shared storage across Proxmox Virtual Environment (VE) hosts using NVMe over Fibre Channel protocol with NetApp ONTAP. This configuration provides high-performance block-level storage access with low latency using the modern NVMe protocol.

//video::80164fe4-06db-4c21-a25d-b22e0179c3d2[panopto, title="LVM shared pool with NVMe/FC using ONTAP", width=360]

== Initial virtualization administrator tasks

. Verify two HBA interfaces are available.

. On every Proxmox host in the cluster, run the following commands to collect the WWPN information and verify the nvme-cli package is installed.
+
[source,shell]
----
apt update
apt install nvme-cli
cat /sys/class/fc_host/host*/port_name
nvme show-hostnqn
----

. Provide the collected host NQN and WWPN information to the storage administrator and request an NVMe namespace of the required size.

== Storage administrator tasks

If you are new to ONTAP, use System Manager for a better experience.

. Ensure the SVM is available with NVMe protocol enabled. Refer to link:https://docs.netapp.com/us-en/ontap/san-admin/create-nvme-namespace-subsystem-task.html[NVMe tasks on ONTAP 9 documentation].

. Create the NVMe namespace.
+
image:proxmox-ontap-029.png[nvme namespace creation]

. Create the subsystem and assign host NQNs (if using CLI). Follow the reference link above.

. Ensure Anti-Ransomware protection is enabled on the security tab.
+
image:proxmox-ontap-032.png[Anti-Ransomware status]

. Notify the virtualization administrator that the NVMe namespace is created.

== Final virtualization administrator tasks

. Navigate to a shell on each Proxmox VE host in the cluster and verify the new namespace is visible.

. Check namespace details.
+
[source,shell]
----
nvme list
----

. Inspect and collect device details.
+
[source,shell]
----
nvme list
nvme netapp ontapdevices
nvme list-subsys
lsblk -N
----

. Create the volume group.
+
[source,shell]
----
vgcreate <volume group name> /dev/mapper/<device id>
# Where <volume group name> is the desired name for the volume group and <device id> is the nvme device id.
pvs
# Verify the physical volume is part of the volume group.
vgs
# Verify the volume group is created.
----

. Using the Management UI at `https:<proxmox node>:8006`, click Datacenter, select Storage, click Add, and select LVM.
+
image:proxmox-ontap-026.png[lvm storage navigation]

. Provide the storage ID name, choose the existing volume group, and select the volume group that was just created with the CLI. Check the shared option. With Proxmox VE 9 and above, enable the `Allow Snapshots as Volume-Chain` option, which is visible when the Advanced check box is enabled.
+
image:proxmox-ontap-030.png[lvm on existing vg]

. The following shows a sample storage configuration file for LVM using NVMe/FC:
+
image:proxmox-ontap-031.png[lvm on nvme fc configuration]
