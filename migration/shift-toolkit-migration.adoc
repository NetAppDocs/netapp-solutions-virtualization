---
sidebar: sidebar
permalink: migration/shift-toolkit-migration.html
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox
summary: 
---
= Migrate VMs using the Shift Toolkit
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ../media/

[.lead]
Use the Shift Toolkit to migrate VMs between virtualization platforms. The process involves preparing the VMs, converting disk formats, and configuring network settings on the target environment. 

== Supported Migrations

Shift toolkit provides flexibility in a multi-hypervisor environment by supporting bidirectional migration between the following hypervisors:

* link:shift-toolkit-migrate-esxi2hyperv.html[VMware ESXi to Microsoft Hyper-V]
* link:shift-toolkit-migrate-hyperv2esxi.html[Microsoft Hyper-V to VMware ESXi]
* link:shift-toolkit-migrate-esxi2olvm.html[VMWare ESXi to Oracle Linux Virtualization Manager (OLVM)]
* link:shift-toolkit-migrate-esxi2osv.html[VMWare ESXi to Red Hat OpenShift Virtualization]

== Migration

Once the blueprint is created, “Migrate” option can be exercised. During migrate option, shift toolkit performs a series of steps to convert the disk format and use the converted disk to create virtual machines on Hyper-V host as defined in the blueprint. 

The high-level steps performed are as follows:

Pre-requisite: The VMs must be turned OFF gracefully as per the planned maintenance time. downtime Power OFF VMs in the protection group – at source

* Delete existing snapshots for all VMs in the blueprint 
* Trigger VM snapshots for Blueprint – at source
* Trigger volume snapshot before disk conversion
* Clone and convert VMDK to VHDx format for all VMs
* Power ON VMs in protection group – at target
* Register the networks on each VM
* Remove VMware tools and assign the IP addresses using trigger script or cron job depending on the OS type

=== Factors to know

Before initiating the migration, make sure all the pre-requisites are met. Here's a quick checklist for a recap:

* Ensure the Shift VM is part of the domain
* Ensure CIFS share is configured with appropriate permissions
* The qtree used for migration or conversion have the right security style
* As a quick test, try creating a VM using Hyper-V manager from any of the Hyper-V host within the cluster and place the VHDX on the CIFS share (referred in bullet – a). Try the same from Shift toolkit VM by adding Hyper-V management tools (either via “Programs and Features” or using “PowerShell” - add-windowsfeature rsat-hyper-v-tools)

Note: If there are failures, link:https://learn.microsoft.com/en-us/windows-server/virtualization/hyper-v/manage/remotely-manage-hyper-v-hosts[enable delegation using any authentication protocol].

=== Network Tips and Considerations

The following network considerations must be considered:

* Ensure that the static IP addresses are available and not assigned to another VM

* *For Windows VMs*
** The prepare script makes a copy of the network config details (IP address space, Gateway address, DNS servers) and trigger script (during the migration) will reapply the network settings, be it a single NIC or multiple NICs based on the blueprint mapping. 
** After migration, windows device manager may still display the old network adapter information from pre-migration. While this doesn't affect the new network adapter created post-migration and won't cause IP conflicts, the script doesn't currently delete this old registration, so it remains visible. Upgrade to v4.0 wherein the migration process removes the orphaned network device from registry and device manager.

* *For Linux VMs*
** The prepare script makes a copy of the network config details (IP address space, routes, DNS servers, network device names) and depending on the Linux distribution identify the networking type used and apply the IP settings. The network reassignment script is set a cron job using crontab and triggered on boot. For instance, the cronjob will execute the script (after the migration) on the instance to reapply the network settings, be it a single NIC or multiple NICs based on the blueprint mapping. 

* In certain scenarios, the converted VMs will have interface names like eth0 or ensp0 instead of ens192 or 33 which was on the source side. In this case, the script will update the network config details to match the new interface names. If predictable names are in use (like modern systems) along with proper udev matching rules and the interface name is retained on the target hypervisor side, the script will skip the network side of it and only remove VMware tools and then reboot the VM.
+
Note: Shift toolkit allows overriding network preparation, enabling administrators to run custom scripts for IP assignment or other configurations.

* Shift toolkit currently supports NetworkManager, Netplan, ifconfig and wicked mechanisms and retains the IP as specified in the blueprint.

=== Phases and Options 

Here are the key phases and options of the migration process.

. Prepare VM – Prepare the VMs for the migration, ensures that all prerequisites are thoroughly completed.
. Migrate - Once the preparation is complete, select and migrate VMware VMs to Hyper-V. After the migration is complete, verify that the VMs have booted successfully, and the data has migrated properly.
. Test Migrate - Test migration simulates the migration by converting the VMDK to appropriate format and creating VMs by using converted virtual disk file residing on the qtree. The test migration does not permit network mapping configuration; this task should typically be performed manually to a bubble network.

Note: The Shift toolkit does not alter the source VM, except for copying the scripts needed for VM preparation. This allows for a swift rollback in case of conversion failures.

To trigger Migrate workflow with the configuration specified in the Blueprint, click on Migrate.

image::shift-toolkit-030.png["Dialog showing how to trigger a VM migration"]

Once initiated, the workflow activates, and the conversion process follows the outlined steps to register the VM. If the VMs within the blueprint are not powered off, the Shift toolkit will prompt for a graceful shutdown before proceeding.

image::shift-toolkit-031.png["Dialog showing VM migration process"]

Note: We recommend that no more than ten conversions be triggered in parallel from the same source to the same destination

image::shift-toolkit-032.png["Dialog showing VM migration process"]

The conversion of VMDK to any file format happens in seconds which makes this approach the fastest of all the options that are available for an additional cost. This also helps to reduce VM downtime during migration.

image::shift-toolkit-033.png["Dialog showing VM migration process"]

Once the job is complete, the status of the blueprint changes to “migration Complete”.

image::shift-toolkit-034.png["Dialog showing VM migration process"]
